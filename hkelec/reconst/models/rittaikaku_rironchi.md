# 立体角の厳密式（解析解）
ご希望の、半径 $R$、距離 $D$、天頂角 $\alpha$ を用いた厳密式（解析解）です。この問題は、光源の角度 $\alpha$ によって半球の底面の縁（ふち）が見えるかどうかが変わるため、数学的には**場合分け（区分関数）**となります。変数の定義$R$ : 半球の半径$D$ : 半球の中心から点光源までの距離$\alpha$ : 半球の対称軸（真上）からの角度 ($0 \le \alpha \le \pi$)立体角 $\Omega$ の厳密式1. 底面の縁が見えない場合（真上に近い）条件： $\displaystyle \cos \alpha \ge \frac{R}{D}$$$\Omega = 2\pi \left( 1 - \sqrt{1 - \left(\frac{R}{D}\right)^2} \right)$$2. 底面の縁が見える場合（斜め〜横）条件： $\displaystyle \cos \alpha < \frac{R}{D}$（かつ、半球が光源の手前にある $\alpha < \pi/2 + \arcsin(R/D)$ の範囲）$$\Omega = 2 \arccos\left( \frac{D \cos\alpha}{R} \right) - 2 \sqrt{1 - \left(\frac{R}{D}\right)^2} \arccos\left( \frac{\sqrt{D^2 - R^2}}{R \tan\alpha} \right)$$式の構成要素についての補足上記の「縁が見える場合」の式は、以下の物理的な意味を持つ2つの項から成り立っています。第一項: $2 \arccos\left( \frac{D \cos\alpha}{R} \right)$球の輪郭と、底面のラインが交差してできる「主要な見え掛かり」の成分です。第二項: $- 2 \sqrt{1 - \left(\frac{R}{D}\right)^2} \arccos\left( \dots \right)$底面の平面部分によって切り取られる（隠される）立体角の補正項です。係数の $\sqrt{1 - (R/D)^2}$ は、光源から見た球の「見かけの半径（$\cos\theta_0$）」に相当します。※ 計算実装時は、$\arccos$ の引数が数値誤差で $[-1, 1]$ を超えないようにクリッピング（std::clamp 等）を行ってください。


======================================================================
PMT別の距離依存関数 f_i(r)
======================================================================
Model: f_i(r) = c0_i + c1_i * (1 - sqrt(1 - (32.5/r)^2))

PMT 1:
  f_1(r) = -9.366107 + 1636.050472 * (1 - sqrt(1 - (32.5/r)^2))

PMT 2:
  f_2(r) = -9.418930 + 1692.016502 * (1 - sqrt(1 - (32.5/r)^2))

PMT 3:
  f_3(r) = -2.470141 + 2117.064347 * (1 - sqrt(1 - (32.5/r)^2))

PMT 4:
  f_4(r) = -7.484737 + 1890.202853 * (1 - sqrt(1 - (32.5/r)^2))
