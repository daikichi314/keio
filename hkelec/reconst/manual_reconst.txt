manual for triggered adc data

In hkpd@hkdaq
0. hkpd@hkdaq:~$ mkdir /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX

1. hkpd@hkdaq:~$ . ~/setup_hkelec.sh  ## set up

1.1. ロガーで記録を取り始める。
1.2. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data/2025XXXX$ SyncPD.py
1.3. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ ~/hkelec/DiscreteSoftware/data/analyze.sh /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX/Sync...
1.4  ~/hkelec/analysis/hkelec-analysis/scripts/pd_to_csv.py
    usage: pd_to_csv.py [-h] -d INDIR --pdcsv PDCSV --sync-hittree SYNC_HITTREE [--outcsv OUTCSV] [--outpdf OUTPDF] [--sync-search-start SYNC_SEARCH_START] [--sync-search-duration SYNC_SEARCH_DURATION]
    [--pd-timescale PD_TIMESCALE]

    Analyze Photodiode CSV data (taken by C9329). For each HK-digitizer run, calculate mean of PD voltage and save it into a CSV file.

    options:
    -h, --help show this help message and exit
    -d INDIR, --indir INDIR
    Input directory that contains hittree files.
    --pdcsv PDCSV Input Photodiode csv file path
    --sync-hittree SYNC_HITTREE
    Input hittree file path for sync run
    --outcsv OUTCSV Output csv file path
    --outpdf OUTPDF Output pdf file path
    --sync-search-start SYNC_SEARCH_START
    Start time of sync search in second
    --sync-search-duration SYNC_SEARCH_DURATION
    Duration of sync search in second
    --pd-timescale PD_TIMESCALE
    Photodiode timescale

ex) ~/hkelec/analysis/hkelec-analysis/scripts/pd_to_csv.py -d ~/hkelec/DiscreteSoftware/data/20251225kishita/ --pdcsv ~/hkelec/DiscreteSoftware/data/20251225kishita/PD_20251225kishita-1.CSV --sync-hittree ~/hkelec/DiscreteSoftware/data/20251225kishita/SyncRun-20251225-143936_hittree.root --outcsv ~/hkelec/DiscreteSoftware/data/20251225kishita/PD_summary20251225.CSV --second

2. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ /home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX/LDhkelec_xxx -l 20 --trgch 4 --switch N ... ## Masurement (make binary file)

    usage: ScanManager.py [-h] [-i RUNID] [-l LENGTH] [--trgch TRGCH] [--dBlist [DBLIST ...]] [--dBstep DBSTEP DBSTEP DBSTEP]

    [--HVlist [HVLIST ...]] [--HVstep HVSTEP HVSTEP HVSTEP] [--threlist [THRELIST ...]]
    [--threstep THRESTEP THRESTEP THRESTEP] [--threpreset] [--threpreset2] [--threpreset3]
    [--gatelist [GATELIST ...]] [--gatestep GATESTEP GATESTEP GATESTEP] [--deadlist [DEADLIST ...]]
    [--deadstep DEADSTEP DEADSTEP DEADSTEP] [--freqlist [FREQLIST ...]]
    [--freqstep FREQSTEP FREQSTEP FREQSTEP] [--chanlist [CHANLIST ...]] [--subdir] [--dryrun]


    Take series of runs while scanning HV/dB/threshold/gate width/veto width settings. Give the list or start/stop/step of
    parameters you want to scan. After a HV scan, the script put the HV back to the default values.


    options:
    -h, --help show this help message and exit
    -i RUNID, --runid RUNID
    Name or identification of this run
    -l LENGTH, --length LENGTH
    Length of the data-taking in second.
    --trgch TRGCH Trigger Channel
    --dBlist [DBLIST ...]
    list of attenuation factors (dB)
    --dBstep DBSTEP DBSTEP DBSTEP
    [start, end, step] of attenuation factors (dB)
    --HVlist [HVLIST ...]
    list of HV values (V)
    --HVstep HVSTEP HVSTEP HVSTEP
    [start, end, step] of HV values (V), e.g. [1000,2000,100] for 1000, 1100, ..., 2000; [2000, 1000, -100]
    for 2000, 1900, ..., 1000.
    --threlist [THRELIST ...]
    list of threshold values (mV, absolute value)
    --threstep THRESTEP THRESTEP THRESTEP
    [start, end, step] of threshold values (mV)
    --threpreset Preset threshold scan values (30 runs, 0.1-20 mV)
    --threpreset2 Preset threshold scan values #2 (20 runs, complementary to #1)
    --threpreset3 Preset threshold scan values #3, in finer steps. (95 runs, includes #1&2)
    --gatelist [GATELIST ...]
    list of integration gate width in DAC (→ 9*DAC + 33 ns)
    --gatestep GATESTEP GATESTEP GATESTEP
    [start, end, step] of integration gate width in DAC
    --deadlist [DEADLIST ...]
    list of veto width in DAC (→ 10*DAC ns)
    --deadstep DEADSTEP DEADSTEP DEADSTEP
    [start, end, step] of veto width in DAC
    --freqlist [FREQLIST ...]
    list of LD frequency [Hz]
    --freqstep FREQSTEP FREQSTEP FREQSTEP
    [start, end, step] of LD frequency [Hz]
    --chanlist [CHANLIST ...]
    Take separate runs for each of channels in this list. Trigger channel is also included if given.
    --subdir Put the data files in a subdirectory
    --dryrun Shows the list of runs to be taken without actually affecting the system

    new
    --freqlist [FREQLIST ...]
                            list of LD frequency [Hz]
    --freqstep FREQSTEP FREQSTEP FREQSTEP
                            [start, end, step] of LD frequency [Hz]
    --chanlist [CHANLIST ...]
                            Take separate runs for each of channels in this list. Trigger channel is also included if given.

    To deal with the noise in trigger channel, let’s set more strict threshold (-1 -> -5 mV) for the trigger channel.
    This can be done by threshold.py --mV 5 --ch 4 (setting -5 mV for channel 4) or, by using --trgch-Vth option of ScanManager.py (--trgch 4 --trgch-Vth 5 for example). Note that ScanManager.py sets the threshold setting to default after each scan.

2.5. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ /home/hkpd/hkelec/DiscreteSoftware/install/bin/RunManager.py -p -i /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX/hkelec_pedestal -l 20  

    hkpd@hkdaq:~$ . setup_hkelec.sh
    hkpd@hkdaq:~/hkelec/DiscreteSoftware$ RunManager.py -h
    usage: RunManager.py [-h] [-p] [-n] [-x] [-c CHS [CHS ...]] [-l LENGTH] [-i RUNID] [—trgch TRGCH] [—dummy]

    Script that manages a single "run", which is a set of the data taken in a costant configuration

    options:
    -h, —help show this help message and exit
    -p, —pedestal Enable pedestal mode
    -n, —normal-run Normal run enabling pedestal 10 Hz
    -x, —cal Enable calibrator mode
    -c CHS [CHS ...], —chs CHS [CHS ...]
    Channels to be acquired. Defautl all channels
    -l LENGTH, —length LENGTH
    Length of the data-taking in second. For dummy runs, this is the timeout and 0
    indicates no timeout
    -i RUNID, —runid RUNID
    Name or identification of this run
    —trgch TRGCH Trigger Channel
    --dummy Flag to start a dummy run

2.6．ロガーを止める

3. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ ~/hkelec/DiscreteSoftware/data/analyze_multi.sh /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX 1  ## .bin -> eventtree.root 

3.5. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ ~/hkelec/DiscreteSoftware/data/analyze.sh /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX/hkelec_pedestal ## .bin -> hithist.root

3.6. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ rename 's/eventtree_-2e-6_10e-6\.root$/eventtree.root/' /home/hkpd/hkelec/DiscreteSoftware/data/20251117kishita/no1/*eventtree_-2e-6_10e-6.root ## delete "_-2e-6_10e-6"

4. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ ~/hkelec/DiscreteSoftware/Analysis/macro/eventtree2hist_multi.sh ~/hkelec/DiscreteSoftware/data/2025XXXX/100pe  ## eventtree.root -> eventhist.root

    # どの項目をヒストグラムにするかは要編集
    # ヒットの採用条件やヒストグラムの表示範囲に注意

5. hkpd@hkdaq:~/hkelec/DiscreteSoftware/data$ ~/hkelec/DiscreteSoftware/Analysis/macro/reconst/macros/sh/run_analysis_batch.sh /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX/  ## 

6. hkpd@hkdaq:~$ scp -r /home/hkpd/hkelec/DiscreteSoftware/data/2025XXXX/ kishita@hep.phys.keio.ac.jp:~/data/  

### 
1. . ~/setup_ana.sh
2. ~/hkelec/analysis/hkelec-analysis/scripts/pd_to_csv.py -d ~/hkelec/DiscreteSoftware/data/2025XXXX --pdcsv ~/hkelec/DiscreteSoftware/data/2025XXXX/PD_2025XXXX-X.CSV 
    usage: pd_to_csv.py [-h] -d INDIR --pdcsv PDCSV --sync-hittree SYNC_HITTREE [--outcsv OUTCSV] [--outpdf OUTPDF] [--sync-search-start SYNC_SEARCH_START] [--sync-search-duration SYNC_SEARCH_DURATION]
    [--pd-timescale PD_TIMESCALE]

    Analyze Photodiode CSV data (taken by C9329). For each HK-digitizer run, calculate mean of PD voltage and save it into a CSV file.

    options:
    -h, --help show this help message and exit
    -d INDIR, --indir INDIR
    Input directory that contains hittree files.
    --pdcsv PDCSV Input Photodiode csv file path
    --sync-hittree SYNC_HITTREE
    Input hittree file path for sync run
    --outcsv OUTCSV Output csv file path
    --outpdf OUTPDF Output pdf file path
    --sync-search-start SYNC_SEARCH_START
    Start time of sync search in second
    --sync-search-duration SYNC_SEARCH_DURATION
    Duration of sync search in second
    --pd-timescale PD_TIMESCALE
    Photodiode timescale


### How to upload macros from daiki to hkpd ###
# 1. 現在のディレクトリ (macro) の中身すべて(*)を
# 2. -r (再帰的に)
# 3. hkpd@hkdaq の指定ディレクトリにコピーする
daiki@daisukekishita:~/keio/hkelec/macro$ scp -r * hkpd@hkdaq:~/hkelec/DiscreteSoftware/Analysis/macro/
daiki@daisukekishita:~/keio/hkelec/reconst$ scp -r * hkpd@hkdaq:~/hkelec/DiscreteSoftware/Analysis/macro/reconst/


### hkpd@hkdaq to kishita@hep ###
# 1. daiki@daisukekishita:~$ ssh -Y hkdaq (_out)
# 2. hkpd@hkdaq:~$ scp -r ~/hkelec/DiscreteSoftware/data/2025XXXX kishita@hep:/home/kishita/data

### kishita@hep to daiki@daisukekishita ###
# 1. daiki@daisukekishita:~$ mkdir -p ~/lab/data/2025XXXX/100pe
# 2. daiki@daisukekishita:~$ scp kishita@hep:/home/kishita/data/2025XXXX/100pe/*eventhist* ~/lab/data/2025XXXX/100pe
# 3. daiki@daisukekishita:~$ scp kishita@hep:/home/kishita/data/2025XXXX/*hithist* ~/lab/data/2025XXXX

### dB list for 0pt scan ###
#3: --dBlist 13.00 15.00 21.00 24.50 33.50 46.00 59.00 


### control the switcher ###
~/hkelec/pmt-scan/scripts/fiber_switcher.py set 0 #(Attenuater) or set 8 (PD)

memo
- eventtree2hist.C
    #ヒットの採用条件やヒストグラムの範囲に注意
    #現在はtime_diffのピークの前後50 nsを採用

- manualをAIにまとめさせる．

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251118/LDhkelec_0pt_diag_no4 -l 20 --trgch 4 --dBlist 13.00 15.00 21.00 24.50 33.50 46.00 59.00

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251118/no2/LDhkelec_0pt_diag_no2 -l 20 --trgch 4 --dBlist 13.00 15.00 21.00 24.50 33.50 46.00 59.00 40 29 23 18 10

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251120kishita/LDhkelec_reconst_dBScan -l 20 --trgch 4 --dBlist 0.6 2 3 4.6 6.6 9 12 15 18 21 24 27 30 33 36 39 50

/LDhkelec_0pt_diag_no4-005-33.50dB_eventhist.root # ノイズのせいかトリガーイベント多すぎ


/home/hkpd/hkelec/DiscreteSoftware/install/bin/RunManager.py -p -i /home/hkpd/hkelec/DiscreteSoftware/data/20251212kishita/hkelec_pedestal -l 20

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251212kishita/LDhkelec_x-35_y35_z160 -l 10 --trgch 4 --switch 2 --trgch-Vth 5 --dBlist 1 1.5 2 3 4 5 6 8 10 12 14 16 19 22 25 29 33 37 41

/home/hkpd/hkelec/DiscreteSoftware/install/bin/RunManager.py -p -i /home/hkpd/hkelec/DiscreteSoftware/data/20251212kishita/no1/hkelec_pedestal -l 20

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251212kishita/no1/LDhkelec_0pt_no1 -l 10 --trgch 4 --switch 2 --trgch-Vth 5 --dBlist 13 13.5 14 14.5 15 16 18 20 22 24 26 28 30 33 36 42 50 58

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251222kishita/LDhkelec_x-35_y-35_z157 -l 10 --trgch 4 --switch 2 --trgch-Vth 5 --dBlist 15 20 15 20

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20251226kishita/LDhkelec_x35_y50_z127 -l 12 --trgch 4 --switch 2 --trgch-Vth 5 --dBlist 15 20

/home/hkpd/hkelec/pmt-scan/scripts/ScanManager.py -i /home/hkpd/hkelec/DiscreteSoftware/data/20260109kishita/no3/LDhkelec_0pt_no3 -l 20 --trgch 4 --trgch-Vth 5 --dBlist 58 50 46 42 39 36 34 32 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14.5 14 13.5 13