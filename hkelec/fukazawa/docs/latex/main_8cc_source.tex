\doxysection{main.\+cc}
\hypertarget{main_8cc_source}{}\label{main_8cc_source}\mbox{\hyperlink{main_8cc}{\mbox{[}詳解\mbox{]}}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{fittinginput_8hh}{fittinginput.hh}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{light__source__fit_8cc}{light\_source\_fit.cc}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00003}00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{light__source__fit_8hh}{light\_source\_fit.hh}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00004}00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{onemPMTfit_8cc}{onemPMTfit.cc}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00005}00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{onemPMTfit_8hh}{onemPMTfit.hh}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00006}00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{readData_8cc}{readData.cc}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00007}00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{readData_8hh}{readData.hh}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <TFile.h>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <TTree.h>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <TVector3.h>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <random>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00016}00016\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00017}00017\ \textcolor{comment}{//\ \#include<bits/stdc++.h>}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00019}\mbox{\hyperlink{main_8cc_ab76dc6b3eaf3ae3469c423127d3d543d}{00019}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{main_8cc_ab76dc6b3eaf3ae3469c423127d3d543d}{writeToCSV}}(\textcolor{keyword}{const}\ std::string\ \&filename,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00020}00020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TVector3\ \&fit,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00021}00021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{onemPMTfit_8cc_a973fb851d96ddc866bae8e425dbed0f4}{t\_light}},}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00022}00022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TVector3\ \&errors,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00023}00023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ t\_error,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00024}00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ chi2)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00025}00025\ \ \ \ \ std::ofstream\ ofs;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00026}00026\ \ \ \ \ \textcolor{comment}{//\ append\ モード}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00027}00027\ \ \ \ \ ofs.open(filename,\ std::ios::out\ |\ std::ios::app);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00028}00028\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ofs.is\_open())\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00029}00029\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}Cannot\ open\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\ for\ writing\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00030}00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00031}00031\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00032}00032\ \ \ \ \ \textcolor{comment}{//\ ヘッダが無ければここで書く（簡易チェック）}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00033}00033\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ header\_written\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00034}00034\ \ \ \ \ \textcolor{keywordflow}{if}\ (!header\_written)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00035}00035\ \ \ \ \ \ \ \ \ ofs\ <<\ \textcolor{stringliteral}{"{}fit\_x,fit\_y,fit\_z,t\_light,err\_x,err\_y,err\_z,t\_error,chi2\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00036}00036\ \ \ \ \ \ \ \ \ header\_written\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00037}00037\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00038}00038\ \ \ \ \ \textcolor{comment}{//\ 書き込み}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00039}00039\ \ \ \ \ ofs\ <<\ fit.X()\ <<\ \textcolor{charliteral}{','}\ <<\ fit.Y()\ <<\ \textcolor{charliteral}{','}\ <<\ fit.Z()\ <<\ \textcolor{charliteral}{','}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00040}00040\ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{onemPMTfit_8cc_a973fb851d96ddc866bae8e425dbed0f4}{t\_light}}\ <<\ \textcolor{charliteral}{','}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00041}00041\ \ \ \ \ \ \ \ \ <<\ errors.X()\ <<\ \textcolor{charliteral}{','}\ <<\ errors.Y()\ <<\ \textcolor{charliteral}{','}\ <<\ errors.Z()\ <<\ \textcolor{charliteral}{','}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00042}00042\ \ \ \ \ \ \ \ \ <<\ t\_error\ <<\ \textcolor{charliteral}{','}\ <<\ chi2\ <<\ \textcolor{charliteral}{'\(\backslash\)n'};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00044}00044\ \ \ \ \ ofs.close();}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00046}00046\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}fit\_x,fit\_y,fit\_z,t\_light,err\_x,err\_y,err\_z,t\_error,chi2"{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00047}00047\ \ \ \ \ std::cout\ <<\ fit.X()\ <<\ \textcolor{charliteral}{','}\ <<\ fit.Y()\ <<\ \textcolor{charliteral}{','}\ <<\ fit.Z()\ <<\ \textcolor{charliteral}{','}\ <<\ \mbox{\hyperlink{onemPMTfit_8cc_a973fb851d96ddc866bae8e425dbed0f4}{t\_light}}\ <<\ \textcolor{charliteral}{','}\ <<\ errors.X()\ <<\ \textcolor{charliteral}{','}\ <<\ errors.Y()\ <<\ \textcolor{charliteral}{','}\ <<\ errors.Z()\ <<\ \textcolor{charliteral}{','}\ <<\ t\_error\ <<\ \textcolor{charliteral}{','}\ <<\ chi2\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00048}00048\ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00050}\mbox{\hyperlink{main_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{00050}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{main_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}()\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00051}00051\ \ \ \ \ std::string\ inputfilename\ =\ \textcolor{stringliteral}{"{}/home/fukazawa/disk3/workdir\_1/MCprod/e-\//results/mom350/sub/e-\/25-\/all"{}};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00052}00052\ \ \ \ \ std::string\ outputcsvfile\ =\ \textcolor{stringliteral}{"{}/home/fukazawa/disk3/hoge.csv"{}};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00054}00054\ \ \ \ \ std::map<int,\ std::vector<PMTData>>\ PMTDataMap;\ \textcolor{comment}{//\ Map\ to\ store\ PMT\ data\ keyed\ by\ mPMTid}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00055}00055\ \ \ \ \ \textcolor{keywordtype}{int}\ status\ =\ \mbox{\hyperlink{readData_8cc_ac3c8af7b5bc5576c180f3442e2ec87c8}{readData}}(inputfilename,\ PMTDataMap);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00056}00056\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00057}00057\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Error\ reading\ data\ for\ event\ "{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;\ \textcolor{comment}{//\ Skip\ this\ event\ if\ there\ was\ an\ error}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00059}00059\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00060}00060\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ 2)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00061}00061\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}No\ data\ for\ event\ "{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00062}00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00063}00063\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00064}00064\ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ ==\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00065}00065\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}all\ data\ was\ read\ "{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00066}00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 3;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00067}00067\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00068}00068\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Data\ read\ successfully."{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00069}00069\ \ \ \ \ \textcolor{comment}{//\ \ Perform\ fitting\ for\ each\ mPMTid}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00070}00070\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}PMTDataMap\ size:\ "{}}\ <<\ PMTDataMap.size()\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00071}00071\ \ \ \ \ \textcolor{keywordtype}{int}\ usePMTnum\ =\ 0;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00073}00073\ \ \ \ \ std::vector<SensorUnit>\ sensorUnits;\ \textcolor{comment}{//\ Vector\ to\ store\ fitted\ sensor\ units}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00074}00074\ \ \ \ \ std::vector<SensorUnit>\ PMTsUnits;\ \ \ \textcolor{comment}{//\ Vector\ to\ store\ 3-\/inch\ PMTs}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00075}00075\ \ \ \ \ \mbox{\hyperlink{structSensorUnit}{SensorUnit}}\ sensorUnit;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00076}00076\ \ \ \ \ \mbox{\hyperlink{structSensorUnit}{SensorUnit}}\ PMTsUnit;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00077}00077\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&pair\ :\ PMTDataMap)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00078}00078\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ mPMTid\ =\ pair.first;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00079}00079\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<PMTData>\ \&pmtData\ =\ pair.second;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pmtData.empty())\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nNo\ data\ for\ mPMTid:\ "{}}\ <<\ mPMTid\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00083}00083\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00085}00085\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ filter\ and\ grouping\ 8\ cm\ PMT\ data\ in\ 1\ mPMT}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00086}00086\ \ \ \ \ \ \ \ \ std::vector<PMTData>\ pmtdata\_use\ =\ \mbox{\hyperlink{onemPMTfit_8cc_a0849c3a1ef2dc7b82ae2b4b5a0d115ed}{findExpandedGroups}}(pmtData,\ 5,\ 3,\ 0.5,\ 6);\ \textcolor{comment}{//\ Optional:\ filter\ or\ group\ data}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00087}00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pmtdata\_use.size()\ <\ 3)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00089}00089\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00091}00091\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ PMT\_i\ =\ 0;\ PMT\_i\ <\ pmtdata\_use.size();\ ++PMT\_i)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_a4fb37869b25f37787e29977ccf10cb4f}{id}}\ =\ pmtdata\_use[PMT\_i].tubeid;\ \textcolor{comment}{//\ PMT\ id}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_ad816683b42209e65f7fa4a9564e6a0d6}{posx}}\ =\ pmtdata\_use[PMT\_i].x;\ \ \ \ \textcolor{comment}{//\ PMT\ x\ position}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_a62b4a14504dd3790f8729dd9b823ac5f}{posy}}\ =\ pmtdata\_use[PMT\_i].y;\ \ \ \ \textcolor{comment}{//\ PMT\ y\ position}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_a2b5ce3b2b516b0eed585e36f9a061f98}{posz}}\ =\ pmtdata\_use[PMT\_i].z;\ \ \ \ \textcolor{comment}{//\ PMT\ z\ position}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_a7ca3111233e2907e3280ccc5bb16ece4}{time}}\ =\ pmtdata\_use[PMT\_i].t;\ \ \ \ \textcolor{comment}{//\ PMT\ time}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_aef7a574a481971eae53db8404c3cb051}{L}}\ =\ pmtdata\_use[PMT\_i].L;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnit.\mbox{\hyperlink{structSensorUnit_a4897a951e777a59476f1726fc1151e48}{sigma\_time}}\ =\ 1;\ \ \ \ \ \ \ \textcolor{comment}{//\ PMT\ time}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ PMTsUnits.push\_back(PMTsUnit);\ \textcolor{comment}{//\ Add\ PMT\ unit\ to\ the\ vector}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00100}00100\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00102}00102\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nFitting\ data\ for\ mPMTid:\ "{}\ <<\ mPMTid\ <<\ "{},\ Number\ of\ PMTs:\ "{}\ <<\ pmtdata\_use.size()\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00104}00104\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ fit\_theta,\ fit\_phi,\ err\_theta,\ err\_phi;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00105}00105\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{onemPMTfit_8cc_ac9ecc9bfc02574be9a8df31a594f792f}{FitPosition}}(pmtdata\_use,\ fit\_theta,\ fit\_phi,\ err\_theta,\ err\_phi);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00106}00106\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ errby\_phi\ =\ err\_phi\ *\ sin(fit\_theta);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00107}00107\ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}error\ angle\ is\ "{}}\ <<\ err\_theta\ <<\ \textcolor{stringliteral}{"{}\ ,\ "{}}\ <<\ err\_phi\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00108}00108\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ timesum\ =\ 0;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00109}00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&pmt\ :\ pmtdata\_use)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ timesum\ +=\ pmt.t;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00111}00111\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00112}00112\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ target\_mPMTid\ =\ mPMTid;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ ori\_x,\ ori\_y,\ ori\_z;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00115}00115\ \ \ \ \ \ \ \ \ ori\_x\ =\ \mbox{\hyperlink{fittinginput_8hh_a493a15bd40482a002847210ed8fa8ba4}{pmt19orientations}}[mPMTid][0];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00116}00116\ \ \ \ \ \ \ \ \ ori\_y\ =\ \mbox{\hyperlink{fittinginput_8hh_a493a15bd40482a002847210ed8fa8ba4}{pmt19orientations}}[mPMTid][1];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00117}00117\ \ \ \ \ \ \ \ \ ori\_z\ =\ \mbox{\hyperlink{fittinginput_8hh_a493a15bd40482a002847210ed8fa8ba4}{pmt19orientations}}[mPMTid][2];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00118}00118\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\{"{}\ <<\ ori\_x\ <<\ "{},\ "{}\ <<\ ori\_y\ <<\ "{},\ "{}\ <<\ ori\_z\ <<\ "{}\},"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00120}00120\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ phi0\_x,\ phi0\_y,\ phi0\_z;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00121}00121\ \ \ \ \ \ \ \ \ phi0\_x\ =\ \mbox{\hyperlink{fittinginput_8hh_afb782434016a2c5bcb6df1c0eec03a8f}{pmt1orientations}}[mPMTid][0];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00122}00122\ \ \ \ \ \ \ \ \ phi0\_y\ =\ \mbox{\hyperlink{fittinginput_8hh_afb782434016a2c5bcb6df1c0eec03a8f}{pmt1orientations}}[mPMTid][1];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00123}00123\ \ \ \ \ \ \ \ \ phi0\_z\ =\ \mbox{\hyperlink{fittinginput_8hh_afb782434016a2c5bcb6df1c0eec03a8f}{pmt1orientations}}[mPMTid][2];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00124}00124\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\ \{"{}\ <<\ phi0\_x\ <<\ "{},\ "{}\ <<\ phi0\_y\ <<\ "{},\ "{}\ <<\ phi0\_z\ <<\ "{}\},"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00126}00126\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ phi90\_x,\ phi90\_y,\ phi90\_z;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00127}00127\ \ \ \ \ \ \ \ \ phi90\_x\ =\ \mbox{\hyperlink{fittinginput_8hh_a4a04df5323f2e95437fc4878740efe03}{pmt4orientations}}[mPMTid][0];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00128}00128\ \ \ \ \ \ \ \ \ phi90\_y\ =\ \mbox{\hyperlink{fittinginput_8hh_a4a04df5323f2e95437fc4878740efe03}{pmt4orientations}}[mPMTid][1];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00129}00129\ \ \ \ \ \ \ \ \ phi90\_z\ =\ \mbox{\hyperlink{fittinginput_8hh_a4a04df5323f2e95437fc4878740efe03}{pmt4orientations}}[mPMTid][2];}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00130}00130\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\ \{"{}\ <<\ phi90\_x\ <<\ "{},\ "{}\ <<\ phi90\_y\ <<\ "{},\ "{}\ <<\ phi90\_z\ <<\ "{}\},"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00132}00132\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ fit\_ori\ =\ cos(fit\_theta);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ori方向成分}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00133}00133\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ fit\_phi0\ =\ sin(fit\_theta)\ *\ cos(fit\_phi);\ \ \textcolor{comment}{//\ phi0方向成分}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00134}00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ fit\_phi90\ =\ sin(fit\_theta)\ *\ sin(fit\_phi);\ \textcolor{comment}{//\ phi90方向成分}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00136}00136\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dir\_x\ =\ fit\_ori\ *\ ori\_x\ +\ fit\_phi0\ *\ phi0\_x\ +\ fit\_phi90\ *\ phi90\_x;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00137}00137\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dir\_y\ =\ fit\_ori\ *\ ori\_y\ +\ fit\_phi0\ *\ phi0\_y\ +\ fit\_phi90\ *\ phi90\_y;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dir\_z\ =\ fit\_ori\ *\ ori\_z\ +\ fit\_phi0\ *\ phi0\_z\ +\ fit\_phi90\ *\ phi90\_z;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00140}00140\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a4fb37869b25f37787e29977ccf10cb4f}{id}}\ =\ pmtdata\_use[0].mPMTid;\ \ \ \ \ \textcolor{comment}{//\ mPMTid\ of\ the\ mPMT}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00141}00141\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_ad816683b42209e65f7fa4a9564e6a0d6}{posx}}\ =\ pmtdata\_use[0].center\_x;\ \textcolor{comment}{//\ Assuming\ center\_x\ is\ the\ position\ of\ the\ mPMT}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00142}00142\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a62b4a14504dd3790f8729dd9b823ac5f}{posy}}\ =\ pmtdata\_use[0].center\_y;\ \textcolor{comment}{//\ Assuming\ center\_y\ is\ the\ position\ of\ the\ mPMT}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00143}00143\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a2b5ce3b2b516b0eed585e36f9a061f98}{posz}}\ =\ pmtdata\_use[0].center\_z;\ \textcolor{comment}{//\ Assuming\ center\_z\ is\ the\ position\ of\ the\ mPMT}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00144}00144\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a7adf24d147b69143c860147c376f06b3}{dirx}}\ =\ dir\_x;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Direction\ vector\ x-\/component}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00145}00145\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a47966df530c698eb9a603bd44c4f6501}{diry}}\ =\ dir\_y;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Direction\ vector\ y-\/component}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00146}00146\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a811c21903f0f7c7aedd4a1f12e24bbc1}{dirz}}\ =\ dir\_z;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Direction\ vector\ z-\/component}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00147}00147\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a7ca3111233e2907e3280ccc5bb16ece4}{time}}\ =\ timesum\ /\ pmtdata\_use.size();}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00148}00148\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sensorUnit.sigma\_sintheta\ =\ sqrt(err\_theta\ *\ err\_theta\ +\ errby\_phi\ *\ errby\_phi);}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00149}00149\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a8a830fed9c025d26eccde3694d57ea66}{sigma\_sintheta}}\ =\ err\_theta;\ \textcolor{comment}{//\ Assuming\ sigma\_sintheta\ is\ the\ error\ in\ theta}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00150}00150\ \ \ \ \ \ \ \ \ sensorUnit.\mbox{\hyperlink{structSensorUnit_a4897a951e777a59476f1726fc1151e48}{sigma\_time}}\ =\ 1;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00151}00151\ \ \ \ \ \ \ \ \ sensorUnits.push\_back(sensorUnit);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00152}00152\ \ \ \ \ \ \ \ \ usePMTnum++;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00153}00153\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00154}00154\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Fitting\ "{}}\ <<\ sensorUnits.size()\ <<\ \textcolor{stringliteral}{"{}\ mPMTs."{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00155}00155\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Using\ "{}}\ <<\ usePMTnum\ <<\ \textcolor{stringliteral}{"{}\ PMTs\ for\ fitting."{}}\ <<\ std::endl;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00157}00157\ \ \ \ \ \textcolor{comment}{//\ Skip\ event\ if\ not\ enough\ number\ of\ PMTs\ hit}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00158}00158\ \ \ \ \ \textcolor{keywordflow}{if}\ (sensorUnits.size()\ <\ 4)\ \{}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00159}00159\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Not\ enough\ sensor\ units\ for\ fitting.\ Skipping\ event\ "{}\ <<\ ev\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00160}00160\ \ \ \ \ \ \ \ \ PMTDataMap.clear();\ \ \textcolor{comment}{//\ Clear\ PMT\ data\ map\ for\ the\ next\ event}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00161}00161\ \ \ \ \ \ \ \ \ PMTsUnits.clear();\ \ \ \textcolor{comment}{//\ Clear\ PMT\ units\ for\ the\ next\ event}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00162}00162\ \ \ \ \ \ \ \ \ sensorUnits.clear();\ \textcolor{comment}{//\ Clear\ sensor\ units\ for\ the\ next\ event}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00163}00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 2;\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ this\ event\ if\ no\ sensor\ units\ were\ created}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00164}00164\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00166}00166\ \ \ \ \ \textcolor{comment}{//\ fitting\ with\ light\_source\_fit}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00167}00167\ \ \ \ \ TVector3\ fit\_pos,\ fiterr\_pos;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00168}00168\ \ \ \ \ \textcolor{keywordtype}{double}\ fit\_time,\ fiterr\_time,\ chi2;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00169}00169\ \ \ \ \ \mbox{\hyperlink{light__source__fit_8cc_a6e959677c04d0c844a7923101d1a4709}{FitLightSource}}(sensorUnits,\ PMTsUnits,\ fit\_pos,\ fit\_time,\ fiterr\_pos,\ fiterr\_time,\ chi2);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00171}00171\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}\(\backslash\)nTotal\ time\ taken:\ "{}\ <<\ duration.count()\ *\ 1000\ <<\ "{}\ ms."{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00172}00172\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Fitted\ position:\ ("{}\ <<\ fit\_pos.X()\ <<\ "{},\ "{}\ <<\ fit\_pos.Y()\ <<\ "{},\ "{}\ <<\ fit\_pos.Z()\ <<\ "{})"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00173}00173\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Fitted\ time:\ "{}\ <<\ fit\_time\ <<\ "{}\ ns"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00174}00174\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Position\ error:\ ("{}\ <<\ fiterr\_pos.X()\ <<\ "{},\ "{}\ <<\ fiterr\_pos.Y()\ <<\ "{},\ "{}\ <<\ fiterr\_pos.Z()\ <<\ "{})"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00175}00175\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Time\ error:\ "{}\ <<\ fiterr\_time\ <<\ "{}\ ns"{}\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00176}00176\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Chi2:\ "{}\ <<\ chi2\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00177}00177\ \ \ \ \ \textcolor{comment}{//\ std::cout\ <<\ "{}Chi2/NDF:\ "{}\ <<\ chi2\ /\ (2\ *\ sensorUnits.size()\ -\/\ 4)\ <<\ std::endl;}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00179}00179\ \ \ \ \ \mbox{\hyperlink{main_8cc_ab76dc6b3eaf3ae3469c423127d3d543d}{writeToCSV}}(}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00180}00180\ \ \ \ \ \ \ \ \ outputcsvfile,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00181}00181\ \ \ \ \ \ \ \ \ fit\_pos,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00182}00182\ \ \ \ \ \ \ \ \ fit\_time,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00183}00183\ \ \ \ \ \ \ \ \ fiterr\_pos,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00184}00184\ \ \ \ \ \ \ \ \ fiterr\_time,}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00185}00185\ \ \ \ \ \ \ \ \ chi2);}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00186}00186\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00187}00187\ \ \ \ \ PMTDataMap.clear();\ \ \textcolor{comment}{//\ Clear\ PMT\ data\ map\ for\ the\ next\ event}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00188}00188\ \ \ \ \ PMTsUnits.clear();\ \ \ \textcolor{comment}{//\ Clear\ PMT\ units\ for\ the\ next\ event}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00189}00189\ \ \ \ \ sensorUnits.clear();\ \textcolor{comment}{//\ Clear\ sensor\ units\ for\ the\ next\ event}}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00190}00190\ }
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00191}00191\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{main_8cc_source_l00192}00192\ \}}

\end{DoxyCode}
